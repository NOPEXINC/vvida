dependencies:
 pre:
  - bower install
 post:
  - npm install module-deps 
  - npm install gulp -g

machine:
  services:
    - postgresql

database:
  # Use postgres 9.1
  pre:
    - sudo service postgresql stop && sudo apt-get remove -y postgresql-9.3 && sudo apt-get update && sudo apt-get install -y postgresql-9.1 postgresql-contrib-9.1 postgresql-9.1-postgis-2.1
    - sudo sed -i "s/\port = 5433/port = 5432/" /etc/postgresql/9.1/main/postgresql.conf
    - sudo cp /etc/postgresql/9.3/main/pg_hba.conf /etc/postgresql/9.1/main/pg_hba.conf
    - sudo service postgresql restart
    - sudo -u postgres createuser ubuntu -d --superuser
    - createdb circle_test

test:
  override:
  - ./tests/server/resources/*.spec.js

deployment:
  production:
    branch: master
    heroku:
      appname: vvida
  staging:
    branch: staging
    heroku:
      appname: vvida-staging